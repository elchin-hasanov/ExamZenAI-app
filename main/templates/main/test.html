{% extends 'main/layout.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <!-- Button to open the formula booklet -->
    {% if subject.name == "Physics" or subject.name ==  "Math" %}
    <div class=" justify-content-start fixed-top mt-5">
        <button class="btn btn-secondary mb-3" style="background-color:#2e3b55; padding: 10px 30px; margin-top: 50px;" onclick="openFormulaBooklet()">Formula Booklet</button>
    </div>
    {% endif %}
    {% if subject.name == "History" or subject.name ==  "English" %}
        <h1 class="text-center mb-5" style="margin-top: 100px; font-size: 35px;">Generated Paper 2 </h1>
    {% else %}
        <h1 class="text-center mb-5" style="margin-top: 100px; font-size: 35px;">Generated Paper 1 </h1>
    {% endif %}
    <div id="timer" class="timer text-center mb-4"></div>
    
    {% if subject.name == "History" %}
        <div>
            {% for topic, questions in questions_by_topic.items %}
                <div class="card mb-3">
                    <div class="card-header">
                        <b>Topic: {{ topic }}</b>
                    </div>
                    <div class="card-body">
                        {% for question in questions %}
                            <p class="card-text">{{ forloop.counter }}. {{ question.text }}</p>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="row justify-content-center mt-4">
            <div class="col-md-6 mb-3">
                <a href="{% url 'main:zens' %}" class="btn btn-danger btn-block">End the Exam</a>
            </div>
        </div>
    
    {% elif subject.name == "English" %}
        <div>
            {% for question in questions %}
                <div class="card mb-3">
                    <div class="card-body">
                        <p class="card-text">{{ forloop.counter }}. {{ question.text }}</p>
                        <div class="radio-toolbar">
                            {% for choice in question.choices_list %}
                                <div class="form-check">
                                    <input class="form-check-input custom-radio" type="radio" id="choice{{ question.id }}_{{ forloop.counter }}" name="answers_{{ question.id }}" value="{{ choice }}" required>
                                    <label class="form-check-label custom-radio-label" for="choice{{ question.id }}_{{ forloop.counter }}">{{ choice }}</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="row justify-content-center mt-4">
            <div class="col-md-6 mb-3">
                <a href="{% url 'main:zens' %}" class="btn btn-danger btn-block">End the Exam</a>
            </div>
        </div>
    
    {% else %}
        <form method="post" action="{% url 'main:submit_exam' %}">
            {% csrf_token %}
            {% if paper == '1' %}
                <input type="hidden" name="test_instance_id" value="{{ test_instance_paper1.id }}">
                <div>
                    {% for question in questions_paper1 %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <p class="card-text">{{ forloop.counter }}. {{ question.text }}</p>
                                <div class="radio-toolbar">
                                    {% for choice in question.choices_list %}
                                        <div class="form-check">
                                            <input class="form-check-input custom-radio" type="radio" id="choice{{ question.id }}_{{ forloop.counter }}" name="answers_{{ question.id }}" value="{{ choice }}">
                                            <label class="form-check-label custom-radio-label" for="choice{{ question.id }}_{{ forloop.counter }}">{{ choice }}</label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="row justify-content-center mt-4">
                    <div class="col-md-6 mb-1">
                        <h1 class="text-center mb-5" style="margin-top: 15px; font-size: 35px;">Generated Paper 2 </h1>
                    </div>
                </div>
            
                <input type="hidden" name="test_instance_id" value="{{ test_instance_paper2.id }}">
                <div>
                    {% for question in questions_paper2 %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <p class="card-text">{{ forloop.counter }}. {{ question.text }}</p>
                                <div class="radio-toolbar">
                                    {% for choice in question.choices_list %}
                                        <div class="form-check">
                                            <input class="form-check-input custom-radio" type="radio" id="choice{{ question.id }}_{{ forloop.counter }}" name="answers_{{ question.id }}" value="{{ choice }}">
                                            <label class="form-check-label custom-radio-label" for="choice{{ question.id }}_{{ forloop.counter }}">{{ choice }}</label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <!-- No need to show 'Move to Paper 2' button on Paper 2 page -->
                <div class="row justify-content-center mt-4">
                    <div class="col-md-6 mb-3">
                        <button type="submit" class="btn btn-primary btn-block" style="background-color: #2e3b55;border: none;">Submit The Exam</button>
                    </div>
                </div>
        </form>
    {% endif %}
</div>
{% endif %}

<!-- Modal for formula booklet -->
<div class="modal fade" id="formulaModal" tabindex="-1" aria-labelledby="formulaModalLabel" aria-hidden="true" style="background">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="formulaModalLabel">Formula Booklet</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" srty>
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                {% if subject.name == "Physics" %}
                    <iframe src="{% static 'images/formulas.pdf' %}" width="100%" height="600px"></iframe>
                {% else %}
                    <iframe src="{% static 'images/formulamath.pdf' %}" width="100%" height="600px"></iframe>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Include Bootstrap JS and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    function openFormulaBooklet() {
        $('#formulaModal').modal('show');
    }
</script>

<style>
    .radio-toolbar {
        display: flex;
        flex-direction: column; /* Display radio buttons in a column */
        gap: 10px;
    }
    
    .radio-toolbar .form-check {
        display: flex;
        align-items: center;
    }
    
    .radio-toolbar .form-check-input {
        opacity: 0;
        position: fixed;
        width: 0;
    }
    
    .radio-toolbar .form-check-label {
        display: flex;
        justify-content: center; /* Center text horizontally */
        align-items: center; /* Center text vertically */
        background-color: #f0f0f0; /* Light grey background */
        padding: 8px 12px; /* Adjusted padding for smaller size */
        font-family: sans-serif, Arial;
        font-size: 17px; /* Reduced font size for smaller size */
        color: #333; /* Darker text color for better readability */
        border: 2px solid #ccc; /* Light grey border */
        border-radius: 4px;
        cursor: pointer;
        text-align: center;
        width: 100%; /* Equal width for all labels */
        box-sizing: border-box;
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
    
    .radio-toolbar .form-check-label:hover {
        background-color: #e0e0e0; /* Light grey hover color */
        border-color: #bbb; /* Slightly darker border on hover */
    }
    
    .radio-toolbar .form-check-input:focus + .form-check-label {
        border: 2px dashed #999; /* Dashed border on focus */
    }
    
    .radio-toolbar .form-check-input:checked + .form-check-label {
        background-color: #4c5c88; /* Darker color for checked state */
        border-color: #4c5c88; /* Darker border color for checked state */
        color: #fff; /* White text color for checked state */
    }
</style>

{% include 'main/style.html' %}
{% endblock %}
